{% extends 'ide/base.html' %}

{% load static %}
{% block content %}
    <link rel="stylesheet" href="{% static 'ide/lib/codemirror.css' %}">
    <script src="{% static 'ide/lib/codemirror.js' %}"></script>
    <script src="{% static 'ide/addon/edit/matchbrackets.js' %}"></script>
    <script src="{% static 'ide/python.js' %}"></script>
    <style>.CodeMirror {border-top: 1px solid black; border-bottom: 1px solid black;}</style>
            <div class="row">
                <div class="col-md-12 page-header">
                    <div class="page-pretitle">Ã‰diteur</div>
                    <h2 class="page-title">{{ project.name }}</h2>
                </div>
            </div>

            <div style="height: 80%">
                <textarea id="code" name="code"></textarea>
                <iframe width="100%" height="33%" allowfullscreen src="http://localhost:8080/?hostname=localhost&port=1222&username={{user.id}}&password={{user.password}}"></iframe>
            </div>


            <script>
                var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
                    mode: {name: "python",
                        version: 3,
                        singleLineStringErrors: false},
                    lineNumbers: true,
                    indentUnit: 4,
                    matchBrackets: true
                });
                editor.setSize("100%", "70%");

                var content = httpGet("http://localhost:8888/command/cat?path=/home/{{user.id}}/{{project.id}}/test.py");
                document.getElementById("code").value = content;

                var isCtrl = false;
                document.onkeyup=function(e){
                    if(e.keyCode == 17) isCtrl=false;
                }

                document.onkeydown=function(e){
                    if(e.keyCode == 17) isCtrl=true;
                    if(e.keyCode == 83 && isCtrl == true) {
                        httpGet("http://localhost:8888/command/write?path=/home/{{user.id}}/{{project.id}}/test.py&fileContent="+editor.getValue());
                        return false;
                    }
                }

                function httpGet(url) {
                    console.log(url);
                    var xmlHttp = new XMLHttpRequest();
                    xmlHttp.open( "GET", url, false );
                    xmlHttp.send( null );
                    return xmlHttp.responseText;
                }
            </script>


{% endblock %}
